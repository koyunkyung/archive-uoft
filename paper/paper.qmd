---
title: "Outbreaks in Toronto Healthcare Institutions After COVID-19"
subtitle: "Analysis of the Frequency Trends and the Causative Agent"
author: 
  - Yunkyung Ko
thanks: "Code and data are available at: https://github.com/koyunkyung/toronto_outbreaks"
date: today
date-format: long
abstract: "In Canada, outbreak incidence has been slowly increasing from June 2024 up to the beginning of the accumulating data period on August 10, 2024. (ADD CITATION https://health-infobase.canada.ca/covid-19/) Using the 'Outbreaks in Toronto Healthcare Institutions' dataset, we show how the trends of outbreak occurrence has been over the 5 years after COVID-19. (specify headline result). (implications)."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(opendatatoronto)
library(ggplot2)
library(dplyr)
library(readr)
library(lubridate)

data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR, @opendatatoronto and @rohan.

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

@fig-outbreak shows the total number of outbreaks reported in Toronto healthcare institutions over the time period of 2020 to 2024. We can see that the numbers seem to decrease by the end of 2021, but exponentially increase from the start of 2022. A trend of relatively high outbreak occurrence rate continues till 2024.


```{r}

```


```{r}
#| label: fig-outbreak
#| fig-cap: Total Outbreaks Count in Toronto Healthcare Institutions
#| echo: false

data |>
  ggplot(mapping = aes(x = year)) +
  geom_bar() +
  theme_minimal() +
  labs(x = "Date Period", y = "Number of Outbreaks Reported",
       title = "Total Number of Outbreaks Reported in Toronto Healthcare Institutions") +
  scale_x_continuous(breaks = seq(min(data$year), max(data$year), by = 1))

```

```{r}
#| label: fig-setting
#| fig-cap: Outbreaks Count by Outbreak Settings
#| echo: false

library(dplyr)
library(ggplot2)

outbreak_counts <- data %>%
  count(outbreak_setting)

ggplot(outbreak_counts, aes(x = "", y = n, fill = outbreak_setting)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) + 
  theme_minimal() +
  scale_fill_manual(values = c("LTCH" = "#B4E1FF", 
                               "Retirement Home" = "#B3FFC6", 
                               "Hospital-Chronic Care" = "#BA55D3", 
                               "Hospital-Acute Care" = "#DDA0DD",
                               "Hospital-Psychiatric" = "grey",
                               "Shelter" = "brown",
                               "Transitional Care" = "black")) +
  labs(x = NULL, y = NULL, fill = "Outbreak Setting", 
       title = "Number of Outbreaks Reported by Setting") +
  theme(axis.text.x = element_blank(),  
        axis.ticks = element_blank(),  
        panel.grid = element_blank())  
```



Contrary to the expectation that the number of outbreaks would have increased the most rapidly immediately after COVID-19, the analysis with actual data shows that the number of outbreaks is on the rise as we approach 2022. Since there are various variables that can affect the result above, we would like to consider this one by one and proceed with an accurate analysis of the outbreak occurrence situation.
### NEED TO MODIFY
# check for factors such as comparing the number of outbreaks as a whole vs. only in healthcare institutions
# would the _begin, _end sorting of timeline affect the shape of the graph above?
# search for background information of healthcare environments in Canada that could relate to the data above


# Result 

To dive deeper into the causations of this trend in outbreak reports, we show the frequency trend of top-3 causative agents respectively over the same time period (@fig-causations).
```{r}

```

```{r}
#| label: fig-outbreaks count by types
#| fig-cap: Outbreaks Count in Toronto Healthcare Institutions, by Types of Outbreak
#| echo: false
#| warning: false
#| message: false

# Summarizing the data to get the number of outbreaks per month and type of outbreak
annual_data <- data %>%
  group_by(year, type_of_outbreak) %>%
  summarise(outbreak_count = n()) %>%
  ungroup()

# Convert the year column to a factor with levels in chronological order
annual_data$year <- factor(annual_data$year, levels = unique(annual_data$year))

# Create the line plot
ggplot(annual_data, aes(x = year, y = outbreak_count, group = type_of_outbreak, color = type_of_outbreak)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  scale_color_manual(values = c("Respiratory" = "red", "Enteric" = "blue", "Other" = "black")) +
  labs(title = "Trend of Outbreak Counts by Type (2016-2024)",
       x = "Year", y = "Outbreak Count", color = "Type of Outbreak") +
  theme_minimal() +
  scale_x_discrete(drop = FALSE) # Ensure all years are shown on the x-axis

```

```{r}
#| label: fig-respiratory outbreaks count by outbreak settings
#| fig-cap: Respiratory Outbreaks Count, by Outbreak Settings
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)

# Filter for 'Respiratory' outbreaks
respiratory_data <- data %>%
  filter(type_of_outbreak == "Respiratory")

# Aggregate data by year and outbreak setting
annual_counts <- respiratory_data %>%
  group_by(year, outbreak_setting) %>%
  summarise(outbreak_count = n(), .groups = 'drop')

# Create a stacked bar plot
ggplot(annual_counts, aes(x = year, y = outbreak_count, fill = outbreak_setting)) +
  geom_col(position = "stack") +  # Stack bars based on outbreak settings
  scale_fill_manual(values = c("LTCH" = "#B4E1FF", 
                               "Retirement Home" = "#B3FFC6", 
                               "Hospital-Chronic Care" = "#BA55D3", 
                               "Hospital-Acute Care" = "#DDA0DD",
                               "Hospital-Psychiatric" = "grey",
                               "Shelter" = "brown",
                               "Transitional Care" = "black")) +
  labs(title = "Annual Respiratory Outbreak Counts by Setting",
       x = "Year",
       y = "Outbreak Count",
       fill = "Outbreak Setting") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(data$year), max(data$year), by = 1))
```


```{r}
#| label: fig-enteric outbreaks count by outbreak settings
#| fig-cap: Enteric Outbreaks Count, by Outbreak Settings
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2)

# Filter for 'Enteric' outbreaks
enteric_data <- data %>%
  filter(type_of_outbreak == "Enteric")

# Aggregate data by year and outbreak setting
annual_counts <- enteric_data %>%
  group_by(year, outbreak_setting) %>%
  summarise(outbreak_count = n(), .groups = 'drop')

# Create a stacked bar plot
ggplot(annual_counts, aes(x = year, y = outbreak_count, fill = outbreak_setting)) +
  geom_col(position = "stack") +  # Stack bars based on outbreak settings
  scale_fill_manual(values = c("LTCH" = "#B4E1FF", 
                               "Retirement Home" = "#B3FFC6", 
                               "Hospital-Chronic Care" = "#BA55D3", 
                               "Hospital-Acute Care" = "#DDA0DD",
                               "Hospital-Psychiatric" = "grey",
                               "Shelter" = "brown",
                               "Transitional Care" = "black")) +
  labs(title = "Annual Enteric Outbreak Counts by Setting",
       x = "Year",
       y = "Outbreak Count",
       fill = "Outbreak Setting") +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(data$year), max(data$year), by = 1))
```
Talk way more about it. 


# Discussion

## First discussion point {#sec-first-point}

analyze the total outbreak frequency trend over the time period given.
(in relation to the social/political background in healthcare)

## Second discussion point

figure out what might be the main causative agent for the rapid increase in outbreak reports starting from 2022.
acknowledging the causative agent that we should be aware of might help us prevent further outbreak increase from happening
-> know what is causing this rise in outbreak reports and research about that specific disease settings

## Third discussion point

from the results of the data analysis above, discuss a way we could prevent further increase of outbreak occurrence.
in largely three dimensions: personal/ society/ government

## Weaknesses and next steps

Dividing a year into just two could influence the analysis result. (ex. weather affecting the outbreak occurrence)
Many 'N/A', 'Unable to identify' data in Causative Agent.

For further inspection, taking the place information in consideration might also have been meaningful.


\newpage

\appendix

# Appendix {-}
INFO OF RAW DATA, CONDITIONS OF DATA COLLECTION, ETC

# Additional data details
NEED TO MODIFY


\newpage


# References
NEED TO ADD REFERENCES

